#!/usr/bin/env bash
# This script configures Nginx to redirect /redirect_me with a 301 Moved Permanently

# Install Nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Define the redirect target
REDIRECT_URL="https://www.youtube.com/watch?v=QH2-TGUlwu4"

# Create a temporary Nginx config file
NGINX_CONF="/etc/nginx/sites-available/default"

# Use sed to insert redirect configuration for /redirect_me
# Backup original config first
cp $NGINX_CONF "${NGINX_CONF}.bak"

# Remove existing redirect_me block if any
sed -i '/location \/redirect_me {/,/}/d' $NGINX_CONF

# Add new redirect block inside the server { } block
sed -i "/server_name _;/a \\\n    location /redirect_me {\n        return 301 $REDIRECT_URL;\n    }" $NGINX_CONF

# Test Nginx config and reload
nginx -t && systemctl reload nginx
